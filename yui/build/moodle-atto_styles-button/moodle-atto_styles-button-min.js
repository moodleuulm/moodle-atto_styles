YUI.add("moodle-atto_styles-button",function(e,t){var n="atto_styles";e.namespace("M.atto_styles").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{initializer:function(){var t=this.get("styles");t=JSON.parse(t);var r=[],i,s;e.Array.each(t,function(e){i="",s="<span>",e.type==="block"?i='<i class="block_element"></i>':e.type!=="nostyle"&&(i='<i class="inline_element"></i>',s='<span class="inlinestyle">'),r.push({text:s+i+e.title+"</span>",callbackArgs:["<"+e.type+">",e.classes]})});var o=this._showToolbarMenu;this._showToolbarMenu=function(e,t){o.call(this,e,t);var n,r,i;n=this.hasRangeSelected(),r=this.menus[t.buttonClass],i=r.get("contentBox"),n?i.removeClass("disableinline"):i.addClass("disableinline")},this.addToolbarMenu({icon:"icon",iconComponent:n,buttonClass:"styles",globalItemConfig:{callback:this._changeStyle},items:r})},_changeStyle:function(e,t){var n,r,i;i=this.get("blockmethod");if(t[0]==="<nostyle>")n=window.getSelection().focusNode,i==="replace"?r=this._getParentBlockOld(n):(r=this._getParentBlock(n,!0),i==="adddiv"&&(r=this._getDiv(r))),r&&r.removeAttribute("class");else if(t[0]==="<block>")i==="replace"&&document.execCommand("formatBlock",!1,"<div>"),n=window.getSelection().focusNode,r=this._getParentBlock(n,i!=="replace"),i==="adddiv"&&(r=this._addDivIfNeeded(r)),r&&r.setAttribute("class",t[1]);else{var s=t[1].split(" ");this.get("host").toggleInlineSelectionClass(s)}this.markUpdated()},_getParentBlock:function(t,n){var r,i,s;for(r=t;r;r=r.parentNode){if(r.nodeType!==1)continue;i=e.one(r);if(i.hasClass("editor_atto_content"))return null;s=i.getComputedStyle("display");if(s==="block"||s==="inline-block"||n&&s==="list-item")return i}},_getParentBlockOld:function(e){var t,n;for(t=e;t;t=t.parentNode){if(t.nodeType!==1)continue;n=window.getComputedStyle(t,null);if(n)return t}return null},_addDivIfNeeded:function(t){var n,r,i;return t?t.get("tagName").toLowerCase()==="div"?t:(n=t.get("parentNode"),n.get("tagName").toLowerCase()==="div"&&n.get("children").size()===1?n:(r=t.next(),i=e.Node.create("<div></div>"),i.appendChild(t),r?n.insertBefore(i,r):n.appendChild(i),i)):null},_getDiv:function(e){var t;return e?e.get("tagName").toLowerCase()==="div"?e:(t=e.get("parentNode"),t.get("tagName").toLowerCase()==="div"?t:null):null},hasRangeSelected:function(){var e,t;return e=rangy.getSelection(),e.rangeCount?(t=e.getRangeAt(0),!t.collapsed):!1}},{ATTRS:{styles:{value:{}},blockmethod:{value:"setclass"}}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});
